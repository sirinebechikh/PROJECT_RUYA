<!-- Modal Backdrop -->
<div class="modal-backdrop" *ngIf="isOpen" (click)="onBackdropClick($event)">
  <!-- Modal Content -->
  <div class="modal-content" [@modalAnimation]="isOpen ? 'open' : 'closed'">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="header-content">
        <div class="logo-section">
          <img src="assets/images/logoAttijari.png" alt="Logo Attijari Bank" class="logo" style="height: 40px; width: auto; border-radius: 12px; box-shadow: 0 2px 12px rgba(34,34,34,0.10); background: #fff;" />
          <div class="title-section">
            <!-- Titre supprimé -->
            <p class="modal-subtitle">Ajouter un nouveau fichier dans ROU'ya</p>

          </div>
        </div>
        <button type="button" class="close-btn close-btn-right" (click)="onClose()">
          <i class="ti ti-x"></i>
        </button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form (ngSubmit)="onSubmit()" #fichierForm="ngForm" class="form-container">
        <div class="form-grid">
          <!-- Type de fichier -->
          <div class="form-group">
            <label for="typeFichier" class="form-label">
              <i class="ti ti-file-text me-2"></i>
              Type de fichier *
            </label>
            <select 
              class="form-select" 
              id="typeFichier" 
              [(ngModel)]="typeFichier" 
              name="typeFichier" 
              required
              #typeFichierCtrl="ngModel">
              <option value="">Sélectionner un type</option>
              <option *ngFor="let type of typesFichier" [value]="type.value">
                <i [class]="type.icon"></i> {{ type.label }}
              </option>
            </select>
            <div class="text-danger" *ngIf="typeFichierCtrl.invalid && (typeFichierCtrl.dirty || typeFichierCtrl.touched)">
              Le type de fichier est requis.
            </div>
          </div>

          <!-- Code fichier -->
          <div class="form-group">
            <label for="codeFichier" class="form-label">
              <i class="ti ti-hash me-2"></i>
              Code fichier *
            </label>
            <select 
              class="form-select" 
              id="codeFichier" 
              [(ngModel)]="codeFichier" 
              name="codeFichier" 
              required
              [disabled]="!typeFichier"
              #codeFichierCtrl="ngModel">
              <option value="">Sélectionner un code</option>
              <option *ngFor="let code of getCodesDisponibles()" [value]="code.value">
                {{ code.label }}
              </option>
            </select>
            <div class="text-danger" *ngIf="codeFichierCtrl.invalid && (codeFichierCtrl.dirty || codeFichierCtrl.touched)">
              Le code fichier est requis.
            </div>
          </div>

          <!-- Sens -->
          <div class="form-group">
            <label for="sens" class="form-label">
              <i class="ti ti-arrows-double-ne-sw me-2"></i>
              Sens *
            </label>
            <select 
              class="form-select" 
              id="sens" 
              [(ngModel)]="sens" 
              name="sens" 
              required
              #sensCtrl="ngModel">
              <option value="">Sélectionner le sens</option>
              <option *ngFor="let option of sensOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
            <div class="text-danger" *ngIf="sensCtrl.invalid && (sensCtrl.dirty || sensCtrl.touched)">
              Le sens est requis.
            </div>
          </div>

          <!-- Code enregistrement -->
          <div class="form-group">
            <label for="codeEnregistrement" class="form-label">
              <i class="ti ti-database me-2"></i>
              Code enregistrement *
            </label>
            <select 
              class="form-select" 
              id="codeEnregistrement" 
              [(ngModel)]="codeEnregistrement" 
              name="codeEnregistrement" 
              required
              #codeEnregistrementCtrl="ngModel">
              <option value="">Sélectionner un code</option>
              <option *ngFor="let code of codeEnregistrementOptions" [value]="code.value">
                {{ code.label }}
              </option>
            </select>
            <div class="text-danger" *ngIf="codeEnregistrementCtrl.invalid && (codeEnregistrementCtrl.dirty || codeEnregistrementCtrl.touched)">
              Le code d'enregistrement est requis.
            </div>
          </div>

          <!-- Format fichier -->
          <div class="form-group">
            <label for="formatFichier" class="form-label">
              <i class="ti ti-file me-2"></i>
              Format fichier *
            </label>
            <select 
              class="form-select" 
              id="formatFichier" 
              [(ngModel)]="formatFichier" 
              name="formatFichier" 
              required
              #formatFichierCtrl="ngModel">
              <option value="">Sélectionner le format</option>
              <option *ngFor="let format of formatFichierOptions" [value]="format.value">
                {{ format.label }}
              </option>
            </select>
            <div class="text-danger" *ngIf="formatFichierCtrl.invalid && (formatFichierCtrl.dirty || formatFichierCtrl.touched)">
              Le format du fichier est requis.
            </div>
          </div>

          <!-- Nom du fichier -->
          <div class="form-group">
            <label for="nomFichier" class="form-label">
              <i class="ti ti-edit me-2"></i>
              Nom du fichier *
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="nomFichier" 
              [(ngModel)]="nomFichier" 
              name="nomFichier" 
              placeholder="Ex: fichier_cheque_30"
              required
              pattern="^[a-zA-Z0-9_-]{5,}$"
              #nomFichierCtrl="ngModel">
            <div class="text-danger" *ngIf="nomFichierCtrl.invalid && (nomFichierCtrl.dirty || nomFichierCtrl.touched)">
              <span *ngIf="nomFichierCtrl.errors?.['required']">Le nom du fichier est requis.</span>
              <span *ngIf="nomFichierCtrl.errors?.['pattern']">Le nom doit comporter au moins 5 caractères (lettres, chiffres, tirets ou underscores).</span>
            </div>
          </div>

          <!-- Montant -->
          <div class="form-group">
            <label for="montant" class="form-label">
              <i class="ti ti-currency-dollar me-2"></i>
              Montant *
            </label>
            <input 
              type="number" 
              class="form-control" 
              id="montant" 
              [(ngModel)]="montant" 
              name="montant" 
              placeholder="Ex: 1000.50"
              required
              min="0"
              step="0.01"
              #montantCtrl="ngModel">
            <div class="text-danger" *ngIf="montantCtrl.invalid && (montantCtrl.dirty || montantCtrl.touched)">
              <span *ngIf="montantCtrl.errors?.['required']">Le montant est requis.</span>
              <span *ngIf="montantCtrl.errors?.['min']">Le montant doit être positif.</span>
            </div>
          </div>

          <!-- Nomber -->
          <div class="form-group">
            <label for="nomber" class="form-label">
              <i class="ti ti-hash me-2"></i>
              Nomber *
            </label>
            <input 
              type="number" 
              class="form-control" 
              id="nomber" 
              [(ngModel)]="nombre" 
              name="nomber" 
              placeholder="Ex: 12345"
              required
              min="1"
              #nomberCtrl="ngModel">
            <div class="text-danger" *ngIf="nomberCtrl.invalid && (nomberCtrl.dirty || nomberCtrl.touched)">
              <span *ngIf="nomberCtrl.errors?.['required']">Le nomber est requis.</span>
              <span *ngIf="nomberCtrl.errors?.['min']">Le nomber doit être supérieur à 0.</span>
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="modal-footer">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="resetForm()">
            <i class="ti ti-refresh me-2"></i>
            Réinitialiser
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="!fichierForm.form.valid">
            <i class="ti ti-plus me-2"></i>
            Ajouter le fichier
          </button>
        </div>
      </form>
    </div>
  </div>
</div> 